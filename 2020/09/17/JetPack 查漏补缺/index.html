<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/ media="defer" onload="this.media='all'">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
<meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ocnyang.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文只介绍 JetPack 学习中你可能需要注意或者你注意不到的知识点，需要你需要你有一定的 JetPack 基础。">
<meta property="og:type" content="article">
<meta property="og:title" content="JetPack 查漏补缺">
<meta property="og:url" content="http://ocnyang.com/2020/09/17/JetPack%20%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/index.html">
<meta property="og:site_name" content="OCNYang の 博客">
<meta property="og:description" content="本文只介绍 JetPack 学习中你可能需要注意或者你注意不到的知识点，需要你需要你有一定的 JetPack 基础。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e54d961df819413a8f6b8fb72e5bc3c2~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25e6a139ec274226949465c61c1209b0~tplv-k3u1fbpfcp-zoom-1.image">
<meta property="article:published_time" content="2020-09-17T11:03:15.000Z">
<meta property="article:modified_time" content="2022-03-15T07:02:36.986Z">
<meta property="article:author" content="OCNYang">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e54d961df819413a8f6b8fb72e5bc3c2~tplv-k3u1fbpfcp-zoom-1.image">

<link rel="canonical" href="http://ocnyang.com/2020/09/17/JetPack%20%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JetPack 查漏补缺 | OCNYang の 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
<script defer src="/live2d-widget/autoload.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">OCNYang の 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Android 开发者，亦涉猎 Flutter</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user-astronaut fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-heartbeat">

    <a href="/categories/%E8%BF%98%E7%9B%B8%E4%BF%A1%E7%88%B1%E6%83%85/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>故事</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ocnyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ocnyang.com/2020/09/17/JetPack%20%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ocnyang.png">
      <meta itemprop="name" content="OCNYang">
      <meta itemprop="description" content="Dancing my fingers across my keyboard.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OCNYang の 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JetPack 查漏补缺
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-17 11:03:15" itemprop="dateCreated datePublished" datetime="2020-09-17T11:03:15+00:00">2020-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-15 07:02:36" itemprop="dateModified" datetime="2022-03-15T07:02:36+00:00">2022-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-%E6%95%99%E7%A8%8B%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">Android 教程系列</span></a>
                </span>
            </span>

          
            <span id="/2020/09/17/JetPack%20%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/" class="post-meta-item leancloud_visitors" data-flag-title="JetPack 查漏补缺" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文只介绍 JetPack 学习中你可能需要注意或者你注意不到的知识点，需要你需要你有一定的 JetPack 基础。</p>
<span id="more"></span>

<h2 id="LifeCycle-相关"><a href="#LifeCycle-相关" class="headerlink" title="LifeCycle 相关"></a>LifeCycle 相关</h2><p>LifeCycle 组件主要用于自定义组件对页面的生命周期的感知，同时又与页面解耦。所有具有生命周期的组件都能够使用 LifeCycle，而具有生命周期的系统组件不仅仅包括 Activity、Fragment，还有 Service 和 Application，自然 LifeCycle 中也对他们俩提供了相关的支持。</p>
<h3 id="LifecycleService"><a href="#LifecycleService" class="headerlink" title="LifecycleService"></a>LifecycleService</h3><p>为了对 Service 生命周期的监听，同时达到解耦 Service 与组件的目的，Jetpack 中提供了一个名为 LifecycleService 的类。它直接继承自 Service（使用起来与普通Service没有差别），并实现了 LifecycleOwner 接口。与 Activity、Fragment 类似，它也提供了一个名为 getLifecycle() 的方法供我们使用。</p>
<p>具体使用：<br><strong>1.</strong> 自定义 LifecycleObserver 来监听 Service 生命周期不同状态的变化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class ServiceLifecycleObserver : LifecycleObserver &#123;</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span><br><span class="line">    fun onServiceCreate() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;Service is create.&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span><br><span class="line">    fun onServiceDestroy() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;Service is destroy.&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.</strong> 在 Service 中绑定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class TestLifecycleService : LifecycleService() &#123;</span><br><span class="line"></span><br><span class="line">    private val serviceLifecycleObserver = ServiceLifecycleObserver()</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        lifecycle.addObserver(serviceLifecycleObserver)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ProcessLifecycleOwner"><a href="#ProcessLifecycleOwner" class="headerlink" title="ProcessLifecycleOwner"></a>ProcessLifecycleOwner</h3><p>LifeCycle 中提供的 ProcessLifecycleOwner 类，用来感知整个应用的生命周期。应用当前状态是处在前台还是后台，或者应用从后台回到前台时状态的切换，我们都能够轻易感知到。</p>
<p>具体使用：<br><strong>1.</strong> 自定义 LifecycleObserver 来监听应用不同状态的变化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">class ApplicationLifecycleObserver : LifecycleObserver &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 在应用程序的整个生命周期中只会被调用一次</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span><br><span class="line">    fun onCreate() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onCreate()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当应用程序在前台出现时被调用</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_START)</span><br><span class="line">    fun onStart() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onStart()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当应用程序在前台出现时被调用</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span><br><span class="line">    fun onResume() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onResume()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当应用程序退出到后台时被调用</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)</span><br><span class="line">    fun onPause() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onPause()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当应用程序退出到后台时被调用</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_STOP)</span><br><span class="line">    fun onStop() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onStop()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 永远不会调用，系统不会分发调用 ON_DESTROY 事件</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span><br><span class="line">    fun onDestroy() &#123;</span><br><span class="line">        Log.e(javaClass.name, &quot;ApplicationLifecycleObserver.onDestroy()&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 自定义 Application 进行绑定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class MyApplication : Application() &#123;</span><br><span class="line">    override fun onCreate() &#123;</span><br><span class="line">        super.onCreate()</span><br><span class="line">        ProcessLifecycleOwner.get().lifecycle.addObserver(ApplicationLifecycleObserver())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>使用方法如上，非常简单。使用时有以下几点值得注意：</p>
<ol>
<li>ProcessLifecycleOwner 是针对整个应用程序的监听，与 Activity 数量无关，你有一个 Activity 或多个 Activity，对ProcessLifecycleOwner 来说是没有区别的。</li>
<li>Lifecycle.Event.ON_CREATE 只会被调用一次，而Lifecycle.Event.ON_DESTROY 永远不会被调用。</li>
<li>当应用程序从后台回到前台，或者应用程序被首次打开时，会依次调用 Lifecycle.Event.ON_START 和 Lifecycle.Event.ON_RESUME。</li>
<li>当应用程序从前台退到后台（用户按下 Home 键或任务菜单键），会依次调用 Lifecycle.Event.ON_PAUSE 和 Lifecycle.Event.ON_STOP。需要注意的是，这两个方法的调用会有一定的延后。这是因为系统需要为“屏幕旋转，由于配置发生变化而导致 Activity 重新创建”的情况预留一些时间。也就是说，系统需要保证当设备出现这种情况时，这两个事件不会被调用。因为当旋转屏幕时，你的应用程序并没有退到后台，它只是进入了横/竖屏模式而已。</li>
</ol>
<h2 id="Navigation-相关"><a href="#Navigation-相关" class="headerlink" title="Navigation 相关"></a>Navigation 相关</h2><h3 id="NavigationUI"><a href="#NavigationUI" class="headerlink" title="NavigationUI"></a>NavigationUI</h3><p>在实际的开发中，不同的页面（这里的页面是 fragment）常常有着不同的顶部标题栏和对应不同的 menu 菜单。为了方便管理，Jetpack 引入了 NavigationUI 组件，使顶部标题栏中的按钮和菜单能够与导航图（res/navigation/navigation_xxx.xml）中的页面关联起来。</p>
<p>其实就算没有 NavigationUI，我们也有多种以往的方法来实现切换 fragment 时对应不同的标题栏。<br>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 方式一：</span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    setHasOptionsMenu(true)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override fun onCreateView(...): View? &#123;</span><br><span class="line">   val inflaterView =  inflater.inflate(R.layout.fragment_XXX, container, false)</span><br><span class="line">   (activity as AppCompatActivity).setSupportActionBar(inflaterView.findViewById(R.id.toolbar))</span><br><span class="line">   // (activity as AppCompatActivity).supportActionBar?.setDisplayHomeAsUpEnabled(true)</span><br><span class="line">   // (activity as AppCompatActivity).supportActionBar?.setHomeButtonEnabled(true)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 方式二：</span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    setHasOptionsMenu(true)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">override fun onCreateOptionsMenu(menu: Menu, inflater: MenuInflater) &#123;</span><br><span class="line">    inflater.inflate(R.menu.menu_xxx, menu)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override fun onOptionsItemSelected(item: MenuItem): Boolean &#123;</span><br><span class="line">    when (item.itemId) &#123;</span><br><span class="line">        R.id.xxx -&gt; &#123;</span><br><span class="line">            ...</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.onOptionsItemSelected(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而 NavigationUI 有着独特的方式对 App bar 和页面切换进行管理。由于这方面的内容繁多，非少量篇幅能够讲解的。这里推荐两篇教程可以详细学习：  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/navigation/navigation-ui">官方文档：使用 NavigationUI 更新界面组件（无需翻墙）</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/69653419">NavigationUI 的使用 (参考Demo)</a></li>
</ul>
<h3 id="DeepLink"><a href="#DeepLink" class="headerlink" title="DeepLink"></a>DeepLink</h3><p>Navigation 组件还有一个非常重要和实用的特性 DeepLink，即深层链接。通过该特性，我们可以利用 PendingIntent 或一个真实的 URL 链接，直接跳转到应用程序中的某个页面（Activity/Fragment）。平时用的 <code>Navigation.findNavController().navigate(...)</code> 只是应用内页面按流程的切换跳转。  </p>
<p>DeepLink 常见的两种应用场景如下：</p>
<ul>
<li>PendingIntent 的方式。当应用程序接收到某个通知推送，你希望用户在单击该通知时，能够直接跳转到展示该通知内容的页面，那么可以通过PendingIntent 来完成此操作。</li>
<li>URL 的方式。当用户通过手机浏览器浏览网站上的某个页面时，可以在网页上放置一个类似于“在应用内打开”的按钮。如果用户的手机安装有我们的应用程序，那么通过 DeepLink 就能打开相应的页面；如果没有安装，那么网站可以导航到应用程序的下载页面，从而引导用户安装应用程序。</li>
</ul>
<p><strong>PendingIntent 方式</strong><br>我们通过 <code>sendNotification()</code> 发送一个通知栏消息，然后这个通知栏消息的点击事件我们设置为跳转到 Navigation 导航图中的某 fragment 页面并传递参数。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">btn.setOnClickListener &#123;</span><br><span class="line">    ...</span><br><span class="line">    val notificationBuilder = NotificationCompat</span><br><span class="line">            .Builder(this,CHANNEL_ID)</span><br><span class="line">            .setContentIntent(getPendingIntent())</span><br><span class="line">            ...</span><br><span class="line">    ...</span><br><span class="line">    NotificationManagerCompat.from(this)</span><br><span class="line">            .notify(1,notificationBuilder.build())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private fun getPendingIntent() = Navigation</span><br><span class="line">        .findNavController(this, R.id.XXX)</span><br><span class="line">        .createDeepLink()</span><br><span class="line">        .setGraph(R.navigation.xxx_navigation)</span><br><span class="line">        .setDestination(R.id.xxxNavigationFragment)</span><br><span class="line">        .setArguments(bundleOf(&quot;params&quot; to &quot;xxx&quot;))</span><br><span class="line">        .createPendingIntent()</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>另外一种创建的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val pendingIntent = NavDeepLinkBuilder(context)</span><br><span class="line">    .setGraph(R.navigation.nav_graph)</span><br><span class="line">    .setDestination(R.id.android)</span><br><span class="line">    .setArguments(args)</span><br><span class="line">    .createPendingIntent()</span><br></pre></td></tr></table></figure>

<p><strong>URL 方式</strong>  </p>
<p><strong>1.</strong> 在导航图中为页面添加 <code>&lt;deepLink/&gt;</code> 标签。在 app:uri 属性中填入的是你的网站的相应 Web 页面地址，后面的参数会通过 Bundle 对象传递到页面中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 导航图文件：res/navigation/nav_graph.xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;navigation  ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;fragment ...&gt;</span><br><span class="line">        &lt;deepLink app:uri=&quot;https://www.ocnyang.com/&#123;placeholder_name&#125;&quot; /&gt;</span><br><span class="line">    &lt;/fragment&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;navigation&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 您还必须向应用的 <code>manifest.xml</code> 文件中添加内容。将一个 <code>&lt;nav-graph&gt;</code> 元素添加到指向现有导航图的 Activity，这样当用户在 Web 页面中访问你的网站时，应用程序便能得到监听。如下例所示：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    package=&quot;com.example.myapplication&quot;&gt;</span><br><span class="line">    &lt;application ... &gt;</span><br><span class="line">        &lt;activity name=&quot;.MainActivity&quot; ...&gt;</span><br><span class="line">            ...</span><br><span class="line">            &lt;nav-graph android:value=&quot;@navigation/nav_graph&quot; /&gt;</span><br><span class="line">            ...</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> 测试</p>
<p>方式一：直接使用命令行在 adb 中测试：<br><code>adb shell am start -W -a android.intent.action.VIEW -d &quot;https://www.ocnyang.com/about&quot;</code></p>
<p>方式二：在网页文件中点击 deeplink 链接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt; ... &lt;/head&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;点击打开 Deeplink&quot; onclick=&quot;javascrtpt:window.location.href=&#x27;https://www.ocnyang.com/about&#x27;&quot;&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里介绍的两种方式都是为了实现，能够直接跳转到导航图 Navigation 中某一页面。但对于 PendingIntent 和 DeepLink 都是两个独立的知识点，更详细的内容大家可以自行搜索教程学习。</p>
</blockquote>
<h2 id="ViewModel-相关"><a href="#ViewModel-相关" class="headerlink" title="ViewModel 相关"></a>ViewModel 相关</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e54d961df819413a8f6b8fb72e5bc3c2~tplv-k3u1fbpfcp-zoom-1.image" alt="ViewModel"></p>
<p>使用者通过工具类（ViewModelProvider）在拥有者（ViewModelStoreOwner，例如：Fragment，FragmentActivity）中获取数据中心（ViewModelStore，简单说就是一个 Map）中的某个数据（ViewModel）。如果数据中心没有，会通过工厂（Factory）创建，最常用的工厂是 AndroidViewModelFactory，它创建的数据包含 Application。</p>
<p><strong>注意：</strong><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25e6a139ec274226949465c61c1209b0~tplv-k3u1fbpfcp-zoom-1.image" alt="ViewModel 生命周期图">  </p>
<ul>
<li>由上图可知，ViewModel 生命周期长，存在于所属对象（Activity，Fragment）的全部生命周期，因此不要向 ViewModel 中传入任何类型的 Context 或带有 Context 引用的对象，这可能会导致页面无法被销毁，从而引发内存泄漏。</li>
<li>横竖屏切换，Activity 重建，所对应的 ViewModel 是同一个，它并没有被销毁，它所持有的数据也一直都存在着。</li>
</ul>
<h3 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h3><p><strong>无参实例化</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val viewModel = ViewModelProvider(this).get(SharedViewModel::class.java)</span><br></pre></td></tr></table></figure>

<p><strong>构造器有参实例化</strong><br>当 ViewModel 的构造器需要穿参数的时候，就不能像上面一样进行实例化了。而需要借助于 ViewModelProvider 的 Fatory 来进行构造。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class SharedViewModel(sharedName: String) : ViewModel() &#123;</span><br><span class="line">    var sharedName: MutableLiveData&lt;String&gt; = MutableLiveData()</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        this.sharedName.value = sharedName</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class SharedViewModelFactory(private val sharedName: String) : </span><br><span class="line">    ViewModelProvider.Factory &#123;</span><br><span class="line">        override fun &lt;T : ViewModel?&gt; create(modelClass: Class&lt;T&gt;): T &#123;</span><br><span class="line">            return SharedViewModel(sharedName) as T</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例化的代码需要改成：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val viewModel = ViewModelProvider(this, SharedViewModel.SharedViewModelFactory(&quot;ocnyang&quot;)).get(SharedViewModel::class.java)</span><br></pre></td></tr></table></figure>

<h3 id="AndroidViewModel"><a href="#AndroidViewModel" class="headerlink" title="AndroidViewModel"></a>AndroidViewModel</h3><p>如果您需要在 viewmodel 中使用上下文，可以选择使用 AndroidViewModel, 因为它包含应用程序上下文 (以检索上下文调用 <code>getApplication()</code>), 否则使用常规 ViewModel。</p>
<p>因可以直接调用 <code>getAppLication()</code> ，所以你可以在 AndroidViewModel 中访问全局资源文件 <code>getApplication().getResources().getString(R.string.XXX);</code> 或通过 SharedPreferences 对数据进行持久化存储等等。</p>
<p>数据库的实例化也需要 Context，ViewModel 是用于存放数据的，因此我们有时将数据库放在 ViewModel 中进行实例化，这时我们就可以选择使用 AndroidViewModel。</p>
<h2 id="LiveData-相关"><a href="#LiveData-相关" class="headerlink" title="LiveData 相关"></a>LiveData 相关</h2><h3 id="数据共享"><a href="#数据共享" class="headerlink" title="数据共享"></a>数据共享</h3><p><strong>1.</strong> Fragment 与 Fragment 之间数据共享（同一个导航图，即同一个 Activity 下的两个页面） </p>
<p>在两个 Fragment 之间共享数据是非常简单的，只需要在两个 Fragment 中实例化 ViewModel 时，通过 <code>getActivity()</code> 让它和 Activity 直接绑定。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val viewModel = ViewModelProvider(getActivity()).get(SharedViewModel::class.java)</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 两个 Activity 之间数据共享</p>
<p>当然你可以直接将 ViewModel 中的 LiveData 数据静态化：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class ShareViewModel : ViewModel() &#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        val shareData = MutableLiveData&lt;ShareBean&gt;()</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式虽然也能实现我们想要的功效，但是我们不提倡这样做。<br>我们常常是通过使 LiveData 作为单例的形式来实现的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 单例 使用时才初始化</span><br><span class="line">class SingletonLiveData : MutableLiveData&lt;ShareBean&gt;() &#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        private lateinit var sInstance: SingletonLiveData</span><br><span class="line"></span><br><span class="line">        @MainThread</span><br><span class="line">        fun get(): SingletonLiveData &#123;</span><br><span class="line">            sInstance = if (::sInstance.isInitialized) sInstance else SingletonLiveData()</span><br><span class="line">            return sInstance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ShareViewModel : ViewModel() &#123;</span><br><span class="line">    val singletonLiveData = SingletonLiveData.get()</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的话，不同的 Activity 就算实例化多次 ViewModel，但使用的都是同一个 LiveData。</p>
<h3 id="LiveData-observeForever"><a href="#LiveData-observeForever" class="headerlink" title="LiveData.observeForever()"></a>LiveData.observeForever()</h3><p>LiveData 还提供了一个名为 <code>observeForever()</code> 的方法，使用起来与 <code>observe()</code> 没有太大差别。它们的区别主要在于，当 LiveData 所包装的数据发生变化时，无论页面处于什么状态，<code>observeForever()</code> 都能收到通知。因此，在用完之后，一定要记得调用 <code>removeObserver()</code> 方法来停止对 LiveData 的观察，否则 LiveData 会一直处于激活状态，Activity 则永远不会被系统自动回收，这就造成了内存泄漏。</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>OCNYang
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://ocnyang.com/2020/09/17/JetPack%20%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/" title="JetPack 查漏补缺">http://ocnyang.com/2020/09/17/JetPack 查漏补缺/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/15/Flutter%20%E6%95%99%E7%A8%8B%E4%B9%8B%20ListTile%20%E4%BB%A5%E5%8F%8A%20CheckboxListTile%20%E7%AD%89%E7%B1%BB%E4%BC%BC%E6%8E%A7%E4%BB%B6%E8%AF%A6%E8%A7%A3/" rel="prev" title="Flutter 教程之 ListTile 以及 CheckboxListTile 等类似控件详解">
      <i class="fa fa-chevron-left"></i> Flutter 教程之 ListTile 以及 CheckboxListTile 等类似控件详解
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/09/ConstraintLayout%20%E5%85%A8%E9%9D%A2%E6%80%BB%E7%BB%93/" rel="next" title="ConstraintLayout 全面总结">
      ConstraintLayout 全面总结 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  

  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#LifeCycle-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.</span> <span class="nav-text">LifeCycle 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LifecycleService"><span class="nav-number">1.1.</span> <span class="nav-text">LifecycleService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProcessLifecycleOwner"><span class="nav-number">1.2.</span> <span class="nav-text">ProcessLifecycleOwner</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Navigation-%E7%9B%B8%E5%85%B3"><span class="nav-number">2.</span> <span class="nav-text">Navigation 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NavigationUI"><span class="nav-number">2.1.</span> <span class="nav-text">NavigationUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DeepLink"><span class="nav-number">2.2.</span> <span class="nav-text">DeepLink</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ViewModel-%E7%9B%B8%E5%85%B3"><span class="nav-number">3.</span> <span class="nav-text">ViewModel 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-number">3.2.</span> <span class="nav-text">实例化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroidViewModel"><span class="nav-number">3.3.</span> <span class="nav-text">AndroidViewModel</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LiveData-%E7%9B%B8%E5%85%B3"><span class="nav-number">4.</span> <span class="nav-text">LiveData 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="nav-number">4.1.</span> <span class="nav-text">数据共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LiveData-observeForever"><span class="nav-number">4.2.</span> <span class="nav-text">LiveData.observeForever()</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="OCNYang"
      src="/images/ocnyang.png">
  <p class="site-author-name" itemprop="name">OCNYang</p>
  <div class="site-description" itemprop="description">Dancing my fingers across my keyboard.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ocnyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ocnyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ocnyang@gmail.com" title="E-Mail → mailto:ocnyang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

      <div></div>
      <div id="music163player">
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=28757267&auto=1&height=32"></iframe>
      </iframe>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>



      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">OCNYang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">425k</span>
</div>

<!---->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/22/2014 20:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '',
      clientSecret: '',
      repo        : '',
      owner       : '',
      admin       : [''],
      id          : '78c3a9728b08c956d71a0398d5151837',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

  
</body>
</html>
